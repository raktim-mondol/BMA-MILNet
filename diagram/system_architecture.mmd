---
title: BMA MIL Classifier - System Architecture
---

graph TB
    %% Input Layer
    subgraph "Input: Pile of Images"
        A1[Image 1<br/>4032×3024]
        A2[Image 2<br/>4032×3024]
        A3[Image N<br/>4032×3024]
    end

    %% Patch Extraction Layer
    subgraph "Patch Extraction"
        B1[Patch Extractor]
        B2[12 Patches per Image<br/>1008×1008]
        B3[Resize to 224×224]
    end

    %% Feature Extraction Layer
    subgraph "Feature Extraction"
        C1[ViT-R50 Model<br/>vit_base_r50_s16_224.orig_in21k]
        C2[768-dimensional<br/>Features per Patch]
    end

    %% Image Level Aggregation
    subgraph "Image Level Aggregation"
        D1[Patch Features<br/>12×768]
        D2[Attention Mechanism]
        D3[Weighted Sum]
        D4[Image Representation<br/>512-dim]
    end

    %% Pile Level Aggregation
    subgraph "Pile Level Aggregation"
        E1[Image Features<br/>N×512]
        E2[Attention Mechanism]
        E3[Weighted Sum]
        E4[Pile Representation<br/>256-dim]
    end

    %% Classification Layer
    subgraph "Classification"
        F1[Classifier Network]
        F2[BMA Class 1-4<br/>Prediction]
    end

    %% Data Flow
    A1 --> B1
    A2 --> B1
    A3 --> B1

    B1 --> B2
    B2 --> B3
    B3 --> C1

    C1 --> C2
    C2 --> D1

    D1 --> D2
    D2 --> D3
    D3 --> D4

    D4 --> E1
    E1 --> E2
    E2 --> E3
    E3 --> E4

    E4 --> F1
    F1 --> F2

    %% Styling
    classDef input fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef patch fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef feature fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef imageAgg fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef pileAgg fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef output fill:#e8eaf6,stroke:#283593,stroke-width:2px

    class A1,A2,A3 input
    class B1,B2,B3 patch
    class C1,C2 feature
    class D1,D2,D3,D4 imageAgg
    class E1,E2,E3,E4 pileAgg
    class F1,F2 output